// Migration tasks, properties are environment dependent.
task migrate {
  // supports only one profile.
  doLast {
    println "Executing $propertyDrivenProfile migrate task actions for ${project.ext.appProps.getProperty('liquibase.change-log')} changelog file."
      def dbUrl, dbUsername, dbPassword
      if(propertyDrivenProfile == 'prod') {
        // Heroku
        dbUrl = System.getenv('JDBC_DATABASE_URL')
          dbUsername = System.getenv('JDBC_DATABASE_USERNAME')
          dbPassword = System.getenv('JDBC_DATABASE_PASSWORD')
      } else {
          dbUrl = project.ext.appProps.getProperty("spring.datasource.url")
          dbUsername = project.ext.appProps.getProperty("spring.datasource.username")
          dbPassword = project.ext.appProps.getProperty("spring.datasource.password")
      }

    liquibase {
      activities {
        main {
          changeLogFile    "$projectDir" + project.ext.appProps.getProperty("liquibase.change-log")
            url           dbUrl
            username      dbUsername
            password      dbPassword
            referenceUrl  'hibernate:spring:com.kabasakalis.springifyapi.domain?dialect=org.hibernate.dialect.PostgreSQLDialect'
            driver        'org.postgresql.Driver'
            referenceDriver  'org.postgresql.Driver'
            classpath    project.ext.appProps.getProperty("liquibase.classpath")

        }
      }
    }
  }
}
